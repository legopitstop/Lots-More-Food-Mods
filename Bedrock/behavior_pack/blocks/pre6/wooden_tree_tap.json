{
  "format_version": "1.20.30",
  "minecraft:block": {
    "description": {
      "identifier": "morefood:wooden_tree_tap",
      "states": {
        "morefood:facing": [2, 3, 4, 5, 6],
        "morefood:sap_level": [0, 1, 2, 3, 4, 5]
      }
    },
    "components": {
      "tag:non_full": {},
      "minecraft:loot": "loot_tables/morefood/blocks/wooden_tree_tap.json",
      "minecraft:light_dampening": 0,
      "minecraft:light_emission": 0,
      "minecraft:geometry": "geometry.tree_tap",
      "minecraft:on_player_placing": {
        "event": "morefood:place_block"
      },
      "minecraft:collision_box": {
        "origin": [-3, 3, 0],
        "size": [6, 10, 8]
      },
      "minecraft:selection_box": {
        "origin": [-3, 3, 0],
        "size": [6, 10, 8]
      },
      "minecraft:random_ticking": {
        "on_tick": {
          "condition": "q.block_state('morefood:sap_level') != 5",
          "event": "morefood:test"
        }
      },
      "minecraft:placement_filter": {
        "conditions": [
          {
            "allowed_faces": ["side"],
            "block_filter": [
              "minecraft:mangrove_log",
              "minecraft:cherry_log",
              {
                "tags": "q.any_tag('log')"
              }
            ]
          }
        ]
      }
    },
    "permutations": [
      {
        "condition": "q.block_state('morefood:facing') == 2",
        "components": {
          "minecraft:transformation": {
            "rotation": [0, 0, 0]
          }
        }
      },
      {
        "condition": "q.block_state('morefood:facing') == 3",
        "components": {
          "minecraft:transformation": {
            "rotation": [0, 180, 0]
          }
        }
      },
      {
        "condition": "q.block_state('morefood:facing') == 4",
        "components": {
          "minecraft:transformation": {
            "rotation": [0, 90, 0]
          }
        }
      },
      {
        "condition": "q.block_state('morefood:facing') == 5",
        "components": {
          "minecraft:transformation": {
            "rotation": [0, -90, 0]
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 0",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level0",
              "render_method": "alpha_test"
            }
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 1",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level1",
              "render_method": "alpha_test"
            }
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 2",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level2",
              "render_method": "alpha_test"
            }
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 3",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level3",
              "render_method": "alpha_test"
            }
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 4",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level4",
              "render_method": "alpha_test"
            }
          }
        }
      },
      {
        "condition": "q.block_state('morefood:sap_level') == 5",
        "components": {
          "minecraft:material_instances": {
            "*": {
              "texture": "morefood:wooden_tree_tap_level5",
              "render_method": "alpha_test"
            }
          },
          "minecraft:on_interact": {
            "condition": "q.is_item_name_any('slot.weapon.mainhand','minecraft:bucket')",
            "event": "morefood:take_sap"
          },
          "minecraft:queued_ticking": {
            "looping": true,
            "interval_range": [100, 100],
            "on_tick": {
              "event": "morefood:sap_drip"
            }
          }
        }
      }
    ],
    "events": {
      "morefood:place_block": {
        "set_block_state": {
          "morefood:facing": "q.cardinal_block_face_placed_on"
        }
      },
      "morefood:sap_drip": {
        "sequence": [
          {
            "run_command": {
              "command": [
                "execute unless block ~ ~-1 ~ cauldron run particle morefood:sap_drip_particle ~ ~-0.3 ~"
              ]
            }
          },
          {
            "condition": "q.block_state('morefood:facing') == 2",
            "run_command": {
              "command": [
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~ ~ morefood:wooden_tree_tap[\"morefood:facing\": 2]",
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~-1 ~ morefood:sap_cauldron"
              ]
            }
          },
          {
            "condition": "q.block_state('morefood:facing') == 3",
            "run_command": {
              "command": [
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~ ~ morefood:wooden_tree_tap[\"morefood:facing\": 3]",
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~-1 ~ morefood:sap_cauldron"
              ]
            }
          },
          {
            "condition": "q.block_state('morefood:facing') == 4",
            "run_command": {
              "command": [
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~ ~ morefood:wooden_tree_tap[\"morefood:facing\": 4]",
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~-1 ~ morefood:sap_cauldron"
              ]
            }
          },
          {
            "condition": "q.block_state('morefood:facing') == 5",
            "run_command": {
              "command": [
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~ ~ morefood:wooden_tree_tap[\"morefood:facing\": 5]",
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~-1 ~ morefood:sap_cauldron"
              ]
            }
          },
          {
            "condition": "q.block_state('morefood:facing') == 6",
            "run_command": {
              "command": [
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~ ~ morefood:wooden_tree_tap[\"morefood:facing\": 6]",
                "execute if block ~ ~-1 ~ cauldron run setblock ~ ~-1 ~ morefood:sap_cauldron"
              ]
            }
          }
        ]
      },
      "morefood:take_sap": {
        "decrement_stack": {},
        "run_command": {
          "command": [
            "playsound bucket.fill_water @a[r=17] ~ ~ ~",
            "give @s morefood:maple_sap_bucket"
          ],
          "target": "player"
        },
        "set_block_state": {
          "morefood:sap_level": "0"
        }
      },
      "morefood:test": {
        "sequence": [
          {
            "condition": "q.block_state('morefood:facing')==2 && q.block_neighbor_has_any_tag(0,0,1,'log') && ( q.block_neighbor_has_any_tag(0,1,1,'log') || q.block_neighbor_has_any_tag(0,-1,1,'log'))",
            "trigger": {
              "event": "morefood:increase_level"
            }
          },
          {
            "condition": "q.block_state('morefood:facing')==3 && q.block_neighbor_has_any_tag(0,0,-1,'log') && ( q.block_neighbor_has_any_tag(0,1,-1,'log') || q.block_neighbor_has_any_tag(0,-1,-1,'log'))",
            "trigger": {
              "event": "morefood:increase_level"
            }
          },
          {
            "condition": "q.block_state('morefood:facing')==4 && q.block_neighbor_has_any_tag(1,0,0,'log') && ( q.block_neighbor_has_any_tag(1,1,0,'log') || q.block_neighbor_has_any_tag(1,-1,0,'log'))",
            "trigger": {
              "event": "morefood:increase_level"
            }
          },
          {
            "condition": "q.block_state('morefood:facing')==5 && q.block_neighbor_has_any_tag(-1,0,0,'log') && ( q.block_neighbor_has_any_tag(-1,1,0,'log') || q.block_neighbor_has_any_tag(-1,-1,0,'log'))",
            "trigger": {
              "event": "morefood:increase_level"
            }
          }
        ]
      },
      "morefood:increase_level": {
        "set_block_state": {
          "morefood:sap_level": "q.block_state('morefood:sap_level') + 1"
        }
      }
    }
  }
}
